# Lab 3

## Lab03-1

### Basic Overview

'''
→ rabin2 -I Lab03-01.exe 
arch     x86
binsz    7168
bintype  pe
bits     32
canary   false
class    PE32
cmp.csum 0x000084e6
compiled Sun Jan  6 15:51:31 2008
crypto   false
endian   little
havecode true
hdr.csum 0x000084e6
linenum  true
lsyms    true
machine  i386
maxopsz  16
minopsz  1
nx       false
os       windows
overlay  false
pcalign  0
pic      false
relocs   true
signed   false
static   false
stripped true
subsys   Windows GUI
va       true

'''

### What are the malwares imports and strings?

some interesting Strings:

'''

SOFTWARE\Classes\http\shell\open\commandV
Software\Microsoft\Active Setup\Installed Components\
test
 www.practicalmalwareanalysis.com
admin	
VideoDriver
WinVMX32-
vmx32to64.exe
SOFTWARE\Microsoft\Windows\CurrentVersion\Run
SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Shell Folders


'''

imports:

'''

→ rabin2 -i Lab03-01.exe 
[Imports]
   1 0x00400200    NONE    FUNC kernel32.dll_ExitProcess


'''

binary seems to be packed due to one single import and relativly high entropy in genral


### What are the malwares host based indicators

analysis at runtime with procmon

* malware writes (itself) in sys32
* uses RNG seed
* sets multiple registry values
	* 
* looks for malwareanalysis.com and beacons it with random string



## Lab03-2

### How can the malware be tricked to install itself?

* the binary has an install routine which can be called with

'''

[0x10004e4d]> afl
...
0x10004706   24 1029         sym.Lab03_02.dll_Install
0x10004b0b    1 13           sym.Lab03_02.dll_installA
0x10004b18   12 275  -> 245  sym.Lab03_02.dll_UninstallService
0x10004c2b    1 13           sym.Lab03_02.dll_uninstallA
...

'''

Imports:

'''
→ rabin2 -i Lab03-02.dll 
[Imports]
   1 0x10005034    NONE    FUNC KERNEL32.dll_GetStartupInfoA
   2 0x10005038    NONE    FUNC KERNEL32.dll_CreatePipe
   3 0x1000503c    NONE    FUNC KERNEL32.dll_GetCurrentDirectoryA
   4 0x10005040    NONE    FUNC KERNEL32.dll_CreateProcessA
...


'''

* the malware has the capabilities to
	* manipulate reg entries
	* open url
	* manipulate services
	* ...


Analysis with strings:

* shows reg keys
* fake service name


### Dynamic host based analysis

Run the dll

C:/rundll32.exe Lab03.02.dll,installA

regshot shows the malware added 14 keys

'''

Keys added:14
----------------------------------
HKLM\SYSTEM\ControlSet001\Services\IPRIP#
...

'''


## Lab03-3

### What is the major code construct?

401011:       83 7d fc 00             cmp    DWORD PTR [ebp-0x4],0x0
  401015:       74 14                   je     0x40102b
  401017:       68 48 70 40 00          push   0x407048
  40101c:       e8 5e 01 00 00          call   0x40117f

* If statment which checks wether an internet connection is active
* prints string wether connection was found or not

### What is the subroutine found at 0x40105F?

